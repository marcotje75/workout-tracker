<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gym Workout Tracker</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: #333;
            padding: 15px;
            min-height: 100vh;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin: 20px 0;
        }
        
        header {
            text-align: center;
            margin-bottom: 20px;
            padding: 10px;
            background: rgba(255,255,255,0.9);
            border-radius: 15px;
        }
        
        h1 {
            font-size: 28px;
            color: #ff2d55;
            margin-bottom: 5px;
        }
        
        .date-display {
            font-size: 16px;
            color: #666;
            margin-bottom: 10px;
        }
        
        .workout-card {
            background: white;
            border-radius: 14px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .workout-title {
            font-size: 20px;
            margin-bottom: 15px;
            color: #007AFF;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .exercise {
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }
        
        .exercise:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .exercise-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .exercise-name {
            font-weight: 600;
            font-size: 18px;
            cursor: pointer;
            flex-grow: 1;
        }
        
        .toggle-exercise {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            padding: 0 10px;
        }
        
        .edit-exercise {
            background: #007AFF;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            font-size: 14px;
            cursor: pointer;
            margin-left: 10px;
        }
        
        .delete-exercise {
            background: #ff3b30;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            font-size: 14px;
            cursor: pointer;
            margin-left: 10px;
        }
        
        .set {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            align-items: center;
        }
        
        .set-number {
            width: 30px;
            font-weight: 600;
        }
        
        input {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            width: 70px;
            text-align: center;
            font-size: 16px;
        }
        
        .add-set, .add-exercise, .save-btn, .weight-btn, .info-btn {
            background-color: #007AFF;
            color: white;
            border: none;
            padding: 12px 15px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
            width: 100%;
            transition: background-color 0.2s;
        }
        
        .add-set:hover, .add-exercise:hover, .save-btn:hover, .weight-btn:hover, .info-btn:hover {
            background-color: #0056CC;
        }
        
        .delete-set {
            background: #ff3b30;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .workout-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .workout-btn {
            padding: 15px 5px;
            text-align: center;
            background: white;
            border: 2px solid #007AFF;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .workout-btn.active {
            background: #007AFF;
            color: white;
        }
        
        .history-btn {
            background-color: #8E8E93;
            color: white;
            border: none;
            padding: 12px 15px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
            width: 100%;
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            color: white;
            font-size: 14px;
            padding: 10px;
        }
        
        .data-info {
            background: #fff8e6;
            padding: 12px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #ffcc00;
            font-size: 14px;
        }
        
        #history-modal, #progress-modal, #weight-modal, #backup-modal, #info-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
            position: sticky;
            top: 0;
            background: white;
            z-index: 10;
        }
        
        .close-modal {
            background: #ff3b30;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .history-item, .progress-item {
            padding: 12px;
            border-bottom: 1px solid #eee;
        }
        
        .history-item:last-child, .progress-item:last-child {
            border-bottom: none;
        }
        
        .history-date, .progress-date {
            font-weight: bold;
            color: #007AFF;
        }
        
        .history-type, .progress-type {
            color: #666;
            font-size: 14px;
        }
        
        .history-exercise, .progress-exercise {
            margin-top: 8px;
            font-size: 14px;
        }
        
        .empty-history {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        .progress-chart {
            margin-top: 15px;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 8px;
        }
        
        .weight-input-container {
            display: flex;
            margin: 15px 0;
        }
        
        #weight-input {
            flex-grow: 1;
            margin-right: 10px;
            width: auto;
        }
        
        .weight-list {
            margin-top: 15px;
        }
        
        .weight-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .tab-buttons {
            display: flex;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            flex: 1;
            min-width: 100px;
            padding: 10px;
            text-align: center;
            background: #f0f0f0;
            border: none;
            cursor: pointer;
        }
        
        .tab-btn.active {
            background: #007AFF;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .comparison {
            margin-top: 10px;
            padding: 10px;
            background: #e6f7ff;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .improvement {
            color: green;
            font-weight: bold;
        }
        
        .decline {
            color: red;
            font-weight: bold;
        }
        
        .backup-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        
        .backup-btn {
            padding: 12px;
            border-radius: 8px;
            border: none;
            background: #007AFF;
            color: white;
            cursor: pointer;
        }
        
        #export-data {
            background: #34C759;
        }
        
        #import-data {
            background: #FF9500;
        }
        
        #clear-data {
            background: #FF3B30;
        }
        
        .history-details {
            margin-top: 8px;
            padding: 8px;
            background: #f9f9f9;
            border-radius: 6px;
            font-size: 13px;
        }
        
        .progress-bar {
            height: 10px;
            background: #eee;
            border-radius: 5px;
            margin: 5px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: #007AFF;
            border-radius: 5px;
        }
        
        .stat-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }
        
        .stat-item {
            padding: 8px;
            background: #f9f9f9;
            border-radius: 6px;
            text-align: center;
        }
        
        .stat-value {
            font-weight: bold;
            font-size: 16px;
            color: #007AFF;
        }
        
        .stat-label {
            font-size: 12px;
            color: #666;
        }
        
        .volume-badge {
            background: #007AFF;
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 12px;
            margin-left: 5px;
        }
        
        .exercise-max {
            margin-top: 5px;
            font-size: 13px;
            color: #666;
        }
        
        /* Progress Explanation Styles */
        .comparison-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin: 30px 0;
        }
        
        .card {
            width: 100%;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .card h2 {
            color: #007AFF;
            border-bottom: 2px solid #007AFF;
            padding-bottom: 10px;
        }
        
        .example {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .progress {
            height: 20px;
            background: #eee;
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: #34C759;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .best-set {
            background: #007AFF;
        }
        
        .volume {
            background: #5856D6;
        }
        
        .key-point {
            background: #e6f7ff;
            padding: 10px;
            border-left: 4px solid #007AFF;
            margin: 10px 0;
        }
        
        .use-case {
            background: #fff8e6;
            padding: 10px;
            border-left: 4px solid #FF9500;
            margin: 10px 0;
        }
        
        /* Exercise Filter Styles */
        .exercise-filter {
            margin-bottom: 15px;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 8px;
        }
        
        .exercise-filter h3 {
            margin-bottom: 10px;
            color: #007AFF;
        }
        
        #exercise-filter-select {
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ddd;
            width: 100%;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Gym Workout Tracker</h1>
            <div class="date-display" id="currentDate">Loading date...</div>
        </header>
        
        <div class="data-info">
            <strong>Data Safety:</strong> Your data is stored in your browser's local storage. 
            To prevent data loss, use the "Backup & Restore" feature to export your data regularly.
            <button class="backup-btn" id="open-backup" style="margin-top: 10px; width: 100%;">Backup & Restore Data</button>
        </div>
        
        <div class="workout-selector">
            <div class="workout-btn active" data-workout="biceps-chest">Biceps & Chest</div>
            <div class="workout-btn" data-workout="triceps-shoulders-back">Triceps, Shoulders & Back</div>
            <div class="workout-btn" data-workout="legs">Legs</div>
            <div class="workout-btn" data-workout="abs">Abs & Core</div>
        </div>
        
        <div class="workout-card" id="workout-content">
            <!-- Workout content will be generated here -->
        </div>
        
        <button class="add-exercise" id="addExercise">+ Add Exercise</button>
        <button class="weight-btn" id="logWeight">Log Today's Weight</button>
        <button class="save-btn" id="saveWorkout">Save Workout</button>
        <div style="display: flex; gap: 10px; margin-top: 10px;">
            <button class="history-btn" id="viewHistory" style="flex: 1;">View History</button>
            <button class="history-btn" id="viewProgress" style="flex: 1;">View Progress</button>
        </div>
        <button class="info-btn" id="showInfo">Progress Tracking Explanation</button>
    </div>
    
    <div id="history-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Workout History</h2>
                <button class="close-modal" id="close-history">×</button>
            </div>
            <div id="history-content">
                <!-- History content will be generated here -->
            </div>
        </div>
    </div>
    
    <div id="progress-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Progress Tracking</h2>
                <button class="close-modal" id="close-progress">×</button>
            </div>
            <div class="tab-buttons">
                <button class="tab-btn active" data-tab="exercises">Exercises</button>
                <button class="tab-btn" data-tab="weight">Weight</button>
                <button class="tab-btn" data-tab="monthly">Monthly</button>
                <button class="tab-btn" data-tab="stats">Statistics</button>
            </div>
            <div class="tab-content active" id="exercises-tab">
                <div class="exercise-filter">
                    <h3>Filter by Exercise:</h3>
                    <select id="exercise-filter-select">
                        <option value="all" selected>All Exercises</option>
                        <!-- Options will be dynamically added here -->
                    </select>
                </div>
                <div id="progress-content">
                    <!-- Progress content will be generated here -->
                </div>
            </div>
            <div class="tab-content" id="weight-tab">
                <div id="weight-progress-content">
                    <!-- Weight progress content will be generated here -->
                </div>
            </div>
            <div class="tab-content" id="monthly-tab">
                <div id="monthly-content">
                    <!-- Monthly progress content will be generated here -->
                </div>
            </div>
            <div class="tab-content" id="stats-tab">
                <div id="stats-content">
                    <!-- Statistics content will be generated here -->
                </div>
            </div>
        </div>
    </div>
    
    <div id="weight-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Log Your Weight</h2>
                <button class="close-modal" id="close-weight">×</button>
            </div>
            <div class="weight-input-container">
                <input type="number" id="weight-input" placeholder="Enter weight in kg" step="0.1" min="0">
                <button class="save-btn" id="save-weight" style="width: auto; padding: 12px;">Save</button>
            </div>
            <div class="weight-list" id="weight-list">
                <!-- Weight entries will be listed here -->
            </div>
        </div>
    </div>
    
    <div id="backup-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Backup & Restore Data</h2>
                <button class="close-modal" id="close-backup">×</button>
            </div>
            <div class="backup-buttons">
                <button class="backup-btn" id="export-data">Export Data</button>
                <button class="backup-btn" id="import-data">Import Data</button>
                <button class="backup-btn" id="clear-data">Clear All Data</button>
            </div>
            <div id="backup-status" style="margin-top: 15px; padding: 10px; border-radius: 8px; display: none;"></div>
        </div>
    </div>
    
    <div id="info-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Progress Tracking Explanation</h2>
                <button class="close-modal" id="close-info">×</button>
            </div>
            <div id="info-content">
                <p>Your workout tracker measures progress in two different ways to give you a complete picture of your improvements.</p>
                
                <div class="comparison-container">
                    <div class="card">
                        <h2>Best Set Progress</h2>
                        <p>Compares your single best set from first to most recent workout</p>
                        
                        <div class="example">
                            <h3>Example: Bench Press</h3>
                            <p><strong>First Workout:</strong><br>
                            Set 1: 10 reps × 50kg = 500 volume<br>
                            Set 2: 8 reps × 55kg = 440 volume<br>
                            Set 3: 6 reps × 60kg = 360 volume</p>
                            
                            <p><strong>Best Set:</strong> 500 volume</p>
                        </div>
                        
                        <div class="example">
                            <h3>Recent Workout</h3>
                            <p><strong>Recent Workout:</strong><br>
                            Set 1: 8 reps × 70kg = 560 volume<br>
                            Set 2: 6 reps × 75kg = 450 volume<br>
                            Set 3: 5 reps × 80kg = 400 volume</p>
                            
                            <p><strong>Best Set:</strong> 560 volume</p>
                        </div>
                        
                        <div class="progress">
                            <div class="progress-fill best-set" style="width: 70%">+12% Improvement</div>
                        </div>
                        
                        <div class="key-point">
                            <strong>Key Point:</strong> Tracks your maximum strength and performance in a single set.
                        </div>
                        
                        <div class="use-case">
                            <strong>Best for:</strong> Measuring pure strength gains and peak performance.
                        </div>
                    </div>
                    
                    <div class="card">
                        <h2>Total Volume Progress</h2>
                        <p>Compares the sum of all sets from first to most recent workout</p>
                        
                        <div class="example">
                            <h3>Example: Bench Press</h3>
                            <p><strong>First Workout:</strong><br>
                            Set 1: 10 reps × 50kg = 500 volume<br>
                            Set 2: 8 reps × 55kg = 440 volume<br>
                            Set 3: 6 reps × 60kg = 360 volume</p>
                            
                            <p><strong>Total Volume:</strong> 500 + 440 + 360 = 1300</p>
                        </div>
                        
                        <div class="example">
                            <h3>Recent Workout</h3>
                            <p><strong>Recent Workout:</strong><br>
                            Set 1: 8 reps × 70kg = 560 volume<br>
                            Set 2: 6 reps × 75kg = 450 volume<br>
                            Set 3: 5 reps × 80kg = 400 volume</p>
                            
                            <p><strong>Total Volume:</strong> 560 + 450 + 400 = 1410</p>
                        </div>
                        
                        <div class="progress">
                            <div class="progress-fill volume" style="width: 85%">+8.5% Improvement</div>
                        </div>
                        
                        <div class="key-point">
                            <strong>Key Point:</strong> Tracks your overall workout volume and endurance.
                        </div>
                        
                        <div class="use-case">
                            <strong>Best for:</strong> Measuring overall workout intensity and muscular endurance.
                        </div>
                    </div>
                </div>
                
                <div style="background: #f4f4f4; padding: 20px; border-radius: 10px; margin-top: 30px;">
                    <h2>Why Both Metrics Matter</h2>
                    <p>These two progress measurements give you different insights into your training:</p>
                    
                    <ul>
                        <li><strong>Best Set Progress</strong> shows your strength gains - are you lifting heavier weights or doing more reps with the same weight?</li>
                        <li><strong>Total Volume Progress</strong> shows your endurance gains - are you able to sustain higher volume across all your sets?</li>
                    </ul>
                    
                    <p>In some cases, you might see a big improvement in one metric but not the other. For example:</p>
                    
                    <div class="example">
                        <p>If your Best Set Progress increases significantly but Total Volume Progress stays the same, it means you're getting stronger but may need to work on endurance.</p>
                        <p>If your Total Volume Progress increases but Best Set Progress stays the same, it means you're building endurance but may need to focus on increasing your maximum strength.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        <p>Your data is stored locally on your device</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Set current date
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('en-US', options);
            
            // Initialize workout data
            let workoutData = {
                type: 'biceps-chest',
                date: now.toISOString().split('T')[0],
                exercises: []
            };
            
            // Load custom exercises from localStorage if they exist
            function loadCustomExercises() {
                const customExercises = JSON.parse(localStorage.getItem('customExercises') || '{}');
                return customExercises;
            }
            
            // Save custom exercises to localStorage
            function saveCustomExercises(customExercises) {
                localStorage.setItem('customExercises', JSON.stringify(customExercises));
            }
            
            // Get exercises for a workout type (with custom names if available)
            function getExercisesForType(type) {
                const customExercises = loadCustomExercises();
                
                // If we have custom exercises for this type, use them
                if (customExercises[type] && customExercises[type].length > 0) {
                    return customExercises[type].map(name => ({
                        name: name,
                        sets: [
                            { reps: '', weight: '' },
                            { reps: '', weight: '' },
                            { reps: '', weight: '' }
                        ],
                        expanded: false
                    }));
                }
                
                // Otherwise, return default exercises
                if (type === 'biceps-chest') {
                    return [
                        {
                            name: 'Bench Press',
                            sets: [
                                { reps: '', weight: '' },
                                { reps: '', weight: '' },
                                { reps: '', weight: '' }
                            ],
                            expanded: false
                        },
                        {
                            name: 'Bicep Curls',
                            sets: [
                                { reps: '', weight: '' },
                                { reps: '', weight: '' },
                                { reps: '', weight: '' }
                            ],
                            expanded: false
                        }
                    ];
                } else if (type === 'triceps-shoulders-back') {
                    return [
                        {
                            name: 'Shoulder Press',
                            sets: [
                                { reps: '', weight: '' },
                                { reps: '', weight: '' },
                                { reps: '', weight: '' }
                            ],
                            expanded: false
                        },
                        {
                            name: 'Tricep Extensions',
                            sets: [
                                { reps: '', weight: '' },
                                { reps: '', weight: '' },
                                { reps: '', weight: '' }
                            ],
                            expanded: false
                        },
                        {
                            name: 'Lat Pulldowns',
                            sets: [
                                { reps: '', weight: '' },
                                { reps: '', weight: '' },
                                { reps: '', weight: '' }
                            ],
                            expanded: false
                        }
                    ];
                } else if (type === 'legs') {
                    return [
                        {
                            name: 'Squats',
                            sets: [
                                { reps: '', weight: '' },
                                { reps: '', weight: '' },
                                { reps: '', weight: '' }
                            ],
                            expanded: false
                        },
                        {
                            name: 'Leg Press',
                            sets: [
                                { reps: '', weight: '' },
                                { reps: '', weight: '' },
                                { reps: '', weight: '' }
                            ],
                            expanded: false
                        },
                        {
                            name: 'Leg Curls',
                            sets: [
                                { reps: '', weight: '' },
                                { reps: '', weight: '' },
                                { reps: '', weight: '' }
                            ],
                            expanded: false
                        }
                    ];
                } else if (type === 'abs') {
                    return [
                        {
                            name: 'Crunches',
                            sets: [
                                { reps: '', weight: '' },
                                { reps: '', weight: '' },
                                { reps: '', weight: '' }
                            ],
                            expanded: false
                        },
                        {
                            name: 'Plank',
                            sets: [
                                { reps: '', weight: '' },
                                { reps: '', weight: '' },
                                { reps: '', weight: '' }
                            ],
                            expanded: false
                        },
                        {
                            name: 'Russian Twists',
                            sets: [
                                { reps: '', weight: '' },
                                { reps: '', weight: '' },
                                { reps: '', weight: '' }
                            ],
                            expanded: false
                        }
                    ];
                }
            }
            
            // Initialize workout data with custom exercises if available
            workoutData.exercises = getExercisesForType(workoutData.type);
            
            // Render workout based on type
            function renderWorkout() {
                const workoutContent = document.getElementById('workout-content');
                workoutContent.innerHTML = '';
                
                workoutData.exercises.forEach((exercise, exerciseIndex) => {
                    const exerciseEl = document.createElement('div');
                    exerciseEl.className = 'exercise';
                    
                    exerciseEl.innerHTML = `
                        <div class="exercise-header">
                            <button class="toggle-exercise" data-exercise="${exerciseIndex}">${exercise.expanded ? '−' : '+'}</button>
                            <div class="exercise-name" data-exercise="${exerciseIndex}">${exercise.name}</div>
                            <button class="edit-exercise" data-exercise="${exerciseIndex}">✎</button>
                            <button class="delete-exercise" data-exercise="${exerciseIndex}">×</button>
                        </div>
                        ${exercise.expanded ? `
                        <div class="sets">
                            ${exercise.sets.map((set, setIndex) => `
                                <div class="set">
                                    <div class="set-number">${setIndex + 1}</div>
                                    <input type="number" placeholder="Reps" min="0" class="reps-input" 
                                        data-exercise="${exerciseIndex}" data-set="${setIndex}" 
                                        value="${set.reps}">
                                    <input type="number" placeholder="Weight" min="0" class="weight-input" 
                                        data-exercise="${exerciseIndex}" data-set="${setIndex}" 
                                        value="${set.weight}">
                                    <button class="delete-set" data-exercise="${exerciseIndex}" data-set="${setIndex}">×</button>
                                </div>
                            `).join('')}
                        </div>
                        <button class="add-set" data-exercise="${exerciseIndex}">+ Add Set</button>
                        ` : ''}
                    `;
                    
                    workoutContent.appendChild(exerciseEl);
                });
                
                // Add event listeners to inputs
                document.querySelectorAll('.reps-input, .weight-input').forEach(input => {
                    input.addEventListener('input', function() {
                        const exerciseIndex = parseInt(this.dataset.exercise);
                        const setIndex = parseInt(this.dataset.set);
                        
                        if (this.classList.contains('reps-input')) {
                            workoutData.exercises[exerciseIndex].sets[setIndex].reps = this.value;
                        } else {
                            workoutData.exercises[exerciseIndex].sets[setIndex].weight = this.value;
                        }
                    });
                });
                
                // Add event listeners to delete buttons
                document.querySelectorAll('.delete-set').forEach(button => {
                    button.addEventListener('click', function() {
                        const exerciseIndex = parseInt(this.dataset.exercise);
                        const setIndex = parseInt(this.dataset.set);
                        
                        if (workoutData.exercises[exerciseIndex].sets.length > 1) {
                            workoutData.exercises[exerciseIndex].sets.splice(setIndex, 1);
                            renderWorkout();
                        }
                    });
                });
                
                // Add event listeners to add-set buttons
                document.querySelectorAll('.add-set').forEach(button => {
                    button.addEventListener('click', function() {
                        const exerciseIndex = parseInt(this.dataset.exercise);
                        workoutData.exercises[exerciseIndex].sets.push({ reps: '', weight: '' });
                        renderWorkout();
                    });
                });
                
                // Add event listeners to toggle buttons
                document.querySelectorAll('.toggle-exercise, .exercise-name').forEach(button => {
                    button.addEventListener('click', function() {
                        const exerciseIndex = parseInt(this.dataset.exercise);
                        workoutData.exercises[exerciseIndex].expanded = !workoutData.exercises[exerciseIndex].expanded;
                        renderWorkout();
                    });
                });
                
                // Add event listeners to edit buttons
                document.querySelectorAll('.edit-exercise').forEach(button => {
                    button.addEventListener('click', function() {
                        const exerciseIndex = parseInt(this.dataset.exercise);
                        const newName = prompt('Enter new exercise name:', workoutData.exercises[exerciseIndex].name);
                        if (newName) {
                            workoutData.exercises[exerciseIndex].name = newName;
                            
                            // Save this as a custom exercise for this workout type
                            const customExercises = loadCustomExercises();
                            if (!customExercises[workoutData.type]) {
                                customExercises[workoutData.type] = [];
                            }
                            
                            // Update the custom exercise name at this position
                            customExercises[workoutData.type][exerciseIndex] = newName;
                            saveCustomExercises(customExercises);
                            
                            renderWorkout();
                        }
                    });
                });
                
                // Add event listeners to delete exercise buttons
                document.querySelectorAll('.delete-exercise').forEach(button => {
                    button.addEventListener('click', function() {
                        const exerciseIndex = parseInt(this.dataset.exercise);
                        if (workoutData.exercises.length > 1) {
                            workoutData.exercises.splice(exerciseIndex, 1);
                            
                            // Also remove from custom exercises
                            const customExercises = loadCustomExercises();
                            if (customExercises[workoutData.type] && customExercises[workoutData.type][exerciseIndex]) {
                                customExercises[workoutData.type].splice(exerciseIndex, 1);
                                saveCustomExercises(customExercises);
                            }
                            
                            renderWorkout();
                        } else {
                            alert('You need at least one exercise.');
                        }
                    });
                });
            }
            
            // Initial render
            renderWorkout();
            
            // Workout type selector
            document.querySelectorAll('.workout-btn').forEach(button => {
                button.addEventListener('click', function() {
                    document.querySelectorAll('.workout-btn').forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    
                    workoutData.type = this.dataset.workout;
                    
                    // Load exercises for this type (with custom names if available)
                    workoutData.exercises = getExercisesForType(workoutData.type);
                    
                    renderWorkout();
                });
            });
            
            // Add exercise button
            document.getElementById('addExercise').addEventListener('click', function() {
                const exerciseName = prompt('Enter exercise name:');
                if (exerciseName) {
                    workoutData.exercises.push({
                        name: exerciseName,
                        sets: [{ reps: '', weight: '' }],
                        expanded: true // New exercises start expanded
                    });
                    
                    // Save this as a custom exercise for this workout type
                    const customExercises = loadCustomExercises();
                    if (!customExercises[workoutData.type]) {
                        customExercises[workoutData.type] = [];
                    }
                    customExercises[workoutData.type].push(exerciseName);
                    saveCustomExercises(customExercises);
                    
                    renderWorkout();
                }
            });
            
            // Save workout button
            document.getElementById('saveWorkout').addEventListener('click', function() {
                // Validate that at least one exercise has data
                let hasData = false;
                workoutData.exercises.forEach(exercise => {
                    exercise.sets.forEach(set => {
                        if (set.reps && set.weight) {
                            hasData = true;
                        }
                    });
                });
                
                if (!hasData) {
                    alert('Please enter at least one set with reps and weight before saving.');
                    return;
                }
                
                // Get existing workouts or initialize empty array
                const savedWorkouts = JSON.parse(localStorage.getItem('workouts') || '[]');
                
                // Add current date to workout
                workoutData.date = now.toISOString().split('T')[0];
                
                // Add to saved workouts
                savedWorkouts.push(workoutData);
                
                // Save back to localStorage
                localStorage.setItem('workouts', JSON.stringify(savedWorkouts));
                
                alert('Workout saved successfully!');
                
                // Reset the form
                workoutData.exercises.forEach(exercise => {
                    exercise.sets.forEach(set => {
                        set.reps = '';
                        set.weight = '';
                    });
                });
                
                renderWorkout();
            });
            
            // View history button
            document.getElementById('viewHistory').addEventListener('click', function() {
                const historyModal = document.getElementById('history-modal');
                const historyContent = document.getElementById('history-content');
                
                // Get saved workouts
                const savedWorkouts = JSON.parse(localStorage.getItem('workouts') || '[]');
                
                if (savedWorkouts.length === 0) {
                    historyContent.innerHTML = '<div class="empty-history">No workout history yet. Save a workout to see it here.</div>';
                } else {
                    // Sort by date, newest first
                    savedWorkouts.sort((a, b) => new Date(b.date) - new Date(a.date));
                    
                    historyContent.innerHTML = '';
                    
                    savedWorkouts.forEach(workout => {
                        const workoutDate = new Date(workout.date);
                        const formattedDate = workoutDate.toLocaleDateString('en-US', { 
                            weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' 
                        });
                        
                        const workoutEl = document.createElement('div');
                        workoutEl.className = 'history-item';
                        
                        let exercisesHTML = '';
                        workout.exercises.forEach(exercise => {
                            let setsHTML = '';
                            exercise.sets.forEach((set, index) => {
                                if (set.reps && set.weight) {
                                    setsHTML += `<div>Set ${index + 1}: ${set.reps} reps × ${set.weight}kg</div>`;
                                }
                            });
                            
                            if (setsHTML) {
                                exercisesHTML += `
                                    <div class="history-exercise">
                                        <strong>${exercise.name}</strong>
                                        <div class="history-details">${setsHTML}</div>
                                    </div>
                                `;
                            }
                        });
                        
                        workoutEl.innerHTML = `
                            <div class="history-date">${formattedDate}</div>
                            <div class="history-type">${workout.type.replace(/-/g, ' ').toUpperCase()}</div>
                            ${exercisesHTML}
                        `;
                        
                        historyContent.appendChild(workoutEl);
                    });
                }
                
                historyModal.style.display = 'flex';
            });
            
            // View progress button
            document.getElementById('viewProgress').addEventListener('click', function() {
                const progressModal = document.getElementById('progress-modal');
                progressModal.style.display = 'flex';
                
                // Show exercises tab by default
                document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                document.querySelector('[data-tab="exercises"]').classList.add('active');
                document.getElementById('exercises-tab').classList.add('active');
                
                // Load progress data
                loadProgressData();
            });
            
            // Load progress data
            function loadProgressData() {
                const savedWorkouts = JSON.parse(localStorage.getItem('workouts') || '[]');
                
                if (savedWorkouts.length === 0) {
                    document.getElementById('progress-content').innerHTML = '<div class="empty-history">No workout data yet. Save a workout to see progress.</div>';
                    document.getElementById('weight-progress-content').innerHTML = '<div class="empty-history">No weight data yet.</div>';
                    document.getElementById('monthly-content').innerHTML = '<div class="empty-history">No monthly data yet.</div>';
                    document.getElementById('stats-content').innerHTML = '<div class="empty-history">No statistics data yet.</div>';
                    return;
                }
                
                // Populate exercise filter dropdown
                const exerciseFilter = document.getElementById('exercise-filter-select');
                exerciseFilter.innerHTML = '<option value="all" selected>All Exercises</option>';
                
                // Get all unique exercise names
                const allExercises = new Set();
                savedWorkouts.forEach(workout => {
                    workout.exercises.forEach(exercise => {
                        allExercises.add(exercise.name);
                    });
                });
                
                allExercises.forEach(exercise => {
                    const option = document.createElement('option');
                    option.value = exercise;
                    option.textContent = exercise;
                    exerciseFilter.appendChild(option);
                });
                
                // Load exercise progress
                loadExerciseProgress('all');
                
                // Load weight progress
                loadWeightProgress();
                
                // Load monthly progress
                loadMonthlyProgress();
                
                // Load statistics
                loadStatistics();
            }
            
            // Load exercise progress
            function loadExerciseProgress(exerciseFilter) {
                const savedWorkouts = JSON.parse(localStorage.getItem('workouts') || '[]');
                const progressContent = document.getElementById('progress-content');
                
                if (savedWorkouts.length === 0) {
                    progressContent.innerHTML = '<div class="empty-history">No workout data yet.</div>';
                    return;
                }
                
                // Group workouts by exercise
                const exerciseData = {};
                
                savedWorkouts.forEach(workout => {
                    workout.exercises.forEach(exercise => {
                        // Skip if we're filtering and this exercise doesn't match
                        if (exerciseFilter !== 'all' && exercise.name !== exerciseFilter) {
                            return;
                        }
                        
                        if (!exerciseData[exercise.name]) {
                            exerciseData[exercise.name] = [];
                        }
                        
                        // Calculate best set and total volume for this exercise in this workout
                        let bestSetVolume = 0;
                        let totalVolume = 0;
                        
                        exercise.sets.forEach(set => {
                            if (set.reps && set.weight) {
                                const reps = parseInt(set.reps);
                                const weight = parseFloat(set.weight);
                                const volume = reps * weight;
                                
                                totalVolume += volume;
                                
                                if (volume > bestSetVolume) {
                                    bestSetVolume = volume;
                                }
                            }
                        });
                        
                        if (totalVolume > 0) {
                            exerciseData[exercise.name].push({
                                date: workout.date,
                                bestSetVolume: bestSetVolume,
                                totalVolume: totalVolume
                            });
                        }
                    });
                });
                
                // Generate HTML for each exercise
                progressContent.innerHTML = '';
                
                Object.keys(exerciseData).forEach(exerciseName => {
                    const data = exerciseData[exerciseName];
                    
                    // Sort by date
                    data.sort((a, b) => new Date(a.date) - new Date(b.date));
                    
                    if (data.length < 2) {
                        // Not enough data to show progress
                        const exerciseEl = document.createElement('div');
                        exerciseEl.className = 'progress-item';
                        exerciseEl.innerHTML = `
                            <div class="progress-date">${exerciseName}</div>
                            <div>Not enough data to show progress (need at least 2 workouts)</div>
                        `;
                        progressContent.appendChild(exerciseEl);
                        return;
                    }
                    
                    const first = data[0];
                    const latest = data[data.length - 1];
                    
                    const bestSetChange = ((latest.bestSetVolume - first.bestSetVolume) / first.bestSetVolume * 100).toFixed(1);
                    const totalVolumeChange = ((latest.totalVolume - first.totalVolume) / first.totalVolume * 100).toFixed(1);
                    
                    const exerciseEl = document.createElement('div');
                    exerciseEl.className = 'progress-item';
                    
                    exerciseEl.innerHTML = `
                        <div class="progress-date">${exerciseName}</div>
                        <div class="progress-chart">
                            <div>Best Set: ${first.bestSetVolume}kg → ${latest.bestSetVolume}kg 
                                <span class="${bestSetChange >= 0 ? 'improvement' : 'decline'}">${bestSetChange >= 0 ? '+' : ''}${bestSetChange}%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${Math.min(Math.abs(bestSetChange) * 2, 100)}%"></div>
                            </div>
                            
                            <div>Total Volume: ${first.totalVolume}kg → ${latest.totalVolume}kg 
                                <span class="${totalVolumeChange >= 0 ? 'improvement' : 'decline'}">${totalVolumeChange >= 0 ? '+' : ''}${totalVolumeChange}%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${Math.min(Math.abs(totalVolumeChange) * 2, 100)}%"></div>
                            </div>
                        </div>
                    `;
                    
                    progressContent.appendChild(exerciseEl);
                });
            }
            
            // Load weight progress
            function loadWeightProgress() {
                const weightData = JSON.parse(localStorage.getItem('weightData') || '[]');
                const weightContent = document.getElementById('weight-progress-content');
                
                if (weightData.length === 0) {
                    weightContent.innerHTML = '<div class="empty-history">No weight data yet. Use "Log Today\'s Weight" to track your weight.</div>';
                    return;
                }
                
                // Sort by date
                weightData.sort((a, b) => new Date(a.date) - new Date(b.date));
                
                weightContent.innerHTML = '';
                
                if (weightData.length < 2) {
                    weightContent.innerHTML = '<div class="empty-history">Not enough weight data to show progress (need at least 2 entries)</div>';
                    return;
                }
                
                const first = weightData[0];
                const latest = weightData[weightData.length - 1];
                
                const weightChange = (latest.weight - first.weight).toFixed(1);
                const weightChangePercent = ((latest.weight - first.weight) / first.weight * 100).toFixed(1);
                
                weightContent.innerHTML = `
                    <div class="progress-item">
                        <div class="progress-date">Weight Progress</div>
                        <div class="progress-chart">
                            <div>Starting Weight: ${first.weight}kg</div>
                            <div>Current Weight: ${latest.weight}kg</div>
                            <div>Change: ${weightChange >= 0 ? '+' : ''}${weightChange}kg 
                                <span class="${weightChange < 0 ? 'improvement' : 'decline'}">${weightChangePercent >= 0 ? '+' : ''}${weightChangePercent}%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${Math.min(Math.abs(weightChangePercent) * 2, 100)}%"></div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Show all weight entries
                const weightList = document.createElement('div');
                weightList.className = 'weight-list';
                
                weightData.forEach(entry => {
                    const entryDate = new Date(entry.date);
                    const formattedDate = entryDate.toLocaleDateString('en-US', { 
                        year: 'numeric', month: 'short', day: 'numeric' 
                    });
                    
                    const entryEl = document.createElement('div');
                    entryEl.className = 'weight-item';
                    entryEl.innerHTML = `
                        <div>${formattedDate}</div>
                        <div>${entry.weight}kg</div>
                    `;
                    
                    weightList.appendChild(entryEl);
                });
                
                weightContent.appendChild(weightList);
            }
            
            // Load monthly progress
            function loadMonthlyProgress() {
                const savedWorkouts = JSON.parse(localStorage.getItem('workouts') || '[]');
                const monthlyContent = document.getElementById('monthly-content');
                
                if (savedWorkouts.length === 0) {
                    monthlyContent.innerHTML = '<div class="empty-history">No workout data yet.</div>';
                    return;
                }
                
                // Group by month
                const monthlyData = {};
                
                savedWorkouts.forEach(workout => {
                    const date = new Date(workout.date);
                    const monthYear = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}`;
                    
                    if (!monthlyData[monthYear]) {
                        monthlyData[monthYear] = {
                            workouts: 0,
                            totalVolume: 0,
                            exercises: 0
                        };
                    }
                    
                    monthlyData[monthYear].workouts += 1;
                    
                    workout.exercises.forEach(exercise => {
                        exercise.sets.forEach(set => {
                            if (set.reps && set.weight) {
                                const reps = parseInt(set.reps);
                                const weight = parseFloat(set.weight);
                                monthlyData[monthYear].totalVolume += reps * weight;
                            }
                        });
                    });
                    
                    monthlyData[monthYear].exercises += workout.exercises.length;
                });
                
                // Generate HTML
                monthlyContent.innerHTML = '';
                
                Object.keys(monthlyData).sort().reverse().forEach(month => {
                    const data = monthlyData[month];
                    const monthName = new Date(month + '-01').toLocaleDateString('en-US', { year: 'numeric', month: 'long' });
                    
                    const monthEl = document.createElement('div');
                    monthEl.className = 'progress-item';
                    
                    monthEl.innerHTML = `
                        <div class="progress-date">${monthName}</div>
                        <div class="stat-grid">
                            <div class="stat-item">
                                <div class="stat-value">${data.workouts}</div>
                                <div class="stat-label">Workouts</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">${Math.round(data.totalVolume)}</div>
                                <div class="stat-label">Total Volume</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">${data.exercises}</div>
                                <div class="stat-label">Exercises</div>
                            </div>
                        </div>
                    `;
                    
                    monthlyContent.appendChild(monthEl);
                });
            }
            
            // Load statistics
            function loadStatistics() {
                const savedWorkouts = JSON.parse(localStorage.getItem('workouts') || '[]');
                const statsContent = document.getElementById('stats-content');
                
                if (savedWorkouts.length === 0) {
                    statsContent.innerHTML = '<div class="empty-history">No workout data yet.</div>';
                    return;
                }
                
                // Calculate statistics
                let totalWorkouts = savedWorkouts.length;
                let totalExercises = 0;
                let totalSets = 0;
                let totalVolume = 0;
                let favoriteExercise = {};
                
                savedWorkouts.forEach(workout => {
                    totalExercises += workout.exercises.length;
                    
                    workout.exercises.forEach(exercise => {
                        // Count exercise frequency
                        if (!favoriteExercise[exercise.name]) {
                            favoriteExercise[exercise.name] = 0;
                        }
                        favoriteExercise[exercise.name] += 1;
                        
                        exercise.sets.forEach(set => {
                            if (set.reps && set.weight) {
                                totalSets += 1;
                                totalVolume += parseInt(set.reps) * parseFloat(set.weight);
                            }
                        });
                    });
                });
                
                // Find most frequent exercise
                let mostFrequentExercise = 'None';
                let maxCount = 0;
                
                Object.keys(favoriteExercise).forEach(exercise => {
                    if (favoriteExercise[exercise] > maxCount) {
                        mostFrequentExercise = exercise;
                        maxCount = favoriteExercise[exercise];
                    }
                });
                
                // Generate HTML
                statsContent.innerHTML = `
                    <div class="stat-grid">
                        <div class="stat-item">
                            <div class="stat-value">${totalWorkouts}</div>
                            <div class="stat-label">Total Workouts</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${totalExercises}</div>
                            <div class="stat-label">Total Exercises</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${totalSets}</div>
                            <div class="stat-label">Total Sets</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${Math.round(totalVolume)}</div>
                            <div class="stat-label">Total Volume</div>
                        </div>
                    </div>
                    <div class="progress-item">
                        <div class="progress-date">Favorite Exercise</div>
                        <div>${mostFrequentExercise} (${maxCount} times)</div>
                    </div>
                `;
            }
            
            // Exercise filter change
            document.getElementById('exercise-filter-select').addEventListener('change', function() {
                loadExerciseProgress(this.value);
            });
            
            // Tab buttons
            document.querySelectorAll('.tab-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const tab = this.dataset.tab;
                    
                    // Update active tab button
                    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Update active tab content
                    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                    document.getElementById(`${tab}-tab`).classList.add('active');
                    
                    // Reload data if needed
                    if (tab === 'exercises') {
                        loadExerciseProgress(document.getElementById('exercise-filter-select').value);
                    } else if (tab === 'weight') {
                        loadWeightProgress();
                    } else if (tab === 'monthly') {
                        loadMonthlyProgress();
                    } else if (tab === 'stats') {
                        loadStatistics();
                    }
                });
            });
            
            // Log weight button
            document.getElementById('logWeight').addEventListener('click', function() {
                const weightModal = document.getElementById('weight-modal');
                const weightList = document.getElementById('weight-list');
                
                // Load weight data
                const weightData = JSON.parse(localStorage.getItem('weightData') || '[]');
                
                // Sort by date, newest first
                weightData.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                // Display weight entries
                weightList.innerHTML = '';
                
                if (weightData.length === 0) {
                    weightList.innerHTML = '<div class="empty-history">No weight entries yet.</div>';
                } else {
                    weightData.forEach(entry => {
                        const entryDate = new Date(entry.date);
                        const formattedDate = entryDate.toLocaleDateString('en-US', { 
                            year: 'numeric', month: 'short', day: 'numeric' 
                        });
                        
                        const entryEl = document.createElement('div');
                        entryEl.className = 'weight-item';
                        entryEl.innerHTML = `
                            <div>${formattedDate}</div>
                            <div>${entry.weight}kg</div>
                        `;
                        
                        weightList.appendChild(entryEl);
                    });
                }
                
                weightModal.style.display = 'flex';
            });
            
            // Save weight button
            document.getElementById('save-weight').addEventListener('click', function() {
                const weightInput = document.getElementById('weight-input');
                const weight = parseFloat(weightInput.value);
                
                if (isNaN(weight) || weight <= 0) {
                    alert('Please enter a valid weight.');
                    return;
                }
                
                // Get existing weight data or initialize empty array
                const weightData = JSON.parse(localStorage.getItem('weightData') || '[]');
                
                // Check if we already have an entry for today
                const today = now.toISOString().split('T')[0];
                const existingIndex = weightData.findIndex(entry => entry.date === today);
                
                if (existingIndex !== -1) {
                    // Update existing entry
                    weightData[existingIndex].weight = weight;
                } else {
                    // Add new entry
                    weightData.push({
                        date: today,
                        weight: weight
                    });
                }
                
                // Save back to localStorage
                localStorage.setItem('weightData', JSON.stringify(weightData));
                
                alert('Weight saved successfully!');
                
                // Close the modal
                document.getElementById('close-weight').click();
            });
            
            // Show info button
            document.getElementById('showInfo').addEventListener('click', function() {
                document.getElementById('info-modal').style.display = 'flex';
            });
            
            // Backup & Restore button
            document.getElementById('open-backup').addEventListener('click', function() {
                document.getElementById('backup-modal').style.display = 'flex';
            });
            
            // Export data button
            document.getElementById('export-data').addEventListener('click', function() {
                const workouts = localStorage.getItem('workouts') || '[]';
                const weightData = localStorage.getItem('weightData') || '[]';
                const customExercises = localStorage.getItem('customExercises') || '{}';
                
                const allData = {
                    workouts: JSON.parse(workouts),
                    weightData: JSON.parse(weightData),
                    customExercises: JSON.parse(customExercises),
                    exportDate: new Date().toISOString()
                };
                
                const dataStr = JSON.stringify(allData, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = 'gym-workout-data.json';
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                const statusEl = document.getElementById('backup-status');
                statusEl.textContent = 'Data exported successfully!';
                statusEl.style.display = 'block';
                statusEl.style.background = '#d4edda';
                statusEl.style.color = '#155724';
                
                setTimeout(() => {
                    statusEl.style.display = 'none';
                }, 3000);
            });
            
            // Import data button
            document.getElementById('import-data').addEventListener('click', function() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                
                input.onchange = e => {
                    const file = e.target.files[0];
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        try {
                            const allData = JSON.parse(e.target.result);
                            
                            if (allData.workouts) {
                                localStorage.setItem('workouts', JSON.stringify(allData.workouts));
                            }
                            
                            if (allData.weightData) {
                                localStorage.setItem('weightData', JSON.stringify(allData.weightData));
                            }
                            
                            if (allData.customExercises) {
                                localStorage.setItem('customExercises', JSON.stringify(allData.customExercises));
                            }
                            
                            const statusEl = document.getElementById('backup-status');
                            statusEl.textContent = 'Data imported successfully!';
                            statusEl.style.display = 'block';
                            statusEl.style.background = '#d4edda';
                            statusEl.style.color = '#155724';
                            
                            setTimeout(() => {
                                statusEl.style.display = 'none';
                            }, 3000);
                            
                        } catch (error) {
                            alert('Error importing data: Invalid file format.');
                        }
                    };
                    
                    reader.readAsText(file);
                };
                
                input.click();
            });
            
            // Clear data button
            document.getElementById('clear-data').addEventListener('click', function() {
                if (confirm('Are you sure you want to clear all data? This cannot be undone.')) {
                    localStorage.removeItem('workouts');
                    localStorage.removeItem('weightData');
                    localStorage.removeItem('customExercises');
                    
                    // Reset current workout
                    workoutData.exercises = getExercisesForType(workoutData.type);
                    renderWorkout();
                    
                    const statusEl = document.getElementById('backup-status');
                    statusEl.textContent = 'All data cleared successfully!';
                    statusEl.style.display = 'block';
                    statusEl.style.background = '#d4edda';
                    statusEl.style.color = '#155724';
                    
                    setTimeout(() => {
                        statusEl.style.display = 'none';
                    }, 3000);
                }
            });
            
            // Close modal buttons
            document.getElementById('close-history').addEventListener('click', function() {
                document.getElementById('history-modal').style.display = 'none';
            });
            
            document.getElementById('close-progress').addEventListener('click', function() {
                document.getElementById('progress-modal').style.display = 'none';
            });
            
            document.getElementById('close-weight').addEventListener('click', function() {
                document.getElementById('weight-modal').style.display = 'none';
            });
            
            document.getElementById('close-backup').addEventListener('click', function() {
                document.getElementById('backup-modal').style.display = 'none';
            });
            
            document.getElementById('close-info').addEventListener('click', function() {
                document.getElementById('info-modal').style.display = 'none';
            });
            
            // Close modals when clicking outside
            window.addEventListener('click', function(event) {
                if (event.target.id === 'history-modal') {
                    document.getElementById('history-modal').style.display = 'none';
                }
                if (event.target.id === 'progress-modal') {
                    document.getElementById('progress-modal').style.display = 'none';
                }
                if (event.target.id === 'weight-modal') {
                    document.getElementById('weight-modal').style.display = 'none';
                }
                if (event.target.id === 'backup-modal') {
                    document.getElementById('backup-modal').style.display = 'none';
                }
                if (event.target.id === 'info-modal') {
                    document.getElementById('info-modal').style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>